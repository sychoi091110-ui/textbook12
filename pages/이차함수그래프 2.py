import streamlit as st
import numpy as np
import matplotlib.pyplot as plt

# 페이지 기본 설정
st.set_page_config(page_title="디지털 교과서 - 유리함수의 그래프", layout="centered")

# 표지
st.title("📘 디지털 교과서: 유리함수의 그래프와 성질")
st.markdown("""
---

### 🌱 학습 목표
- **유리함수**의 뜻을 알고, 기본형 \\( y = \\frac{a}{x} \\)의 그래프를 그릴 수 있다.  
- \\( y = \\frac{ax + b}{cx + d} \\)의 그래프의 **점근선**과 **평행이동**을 이해한다.  
- 계수 변화에 따른 그래프의 변화를 탐구하고, 그 의미를 해석할 수 있다.  

---

""")

# ----------------------------- #
# 1️⃣ 도입: 유리함수란?
# ----------------------------- #
st.header("1️⃣ 유리함수의 개념 알아보기")

st.markdown("""
유리함수는 **두 다항식의 비**로 나타낼 수 있는 함수입니다.  
즉,  
\\[
y = \\frac{P(x)}{Q(x)} \\quad (단, Q(x) ≠ 0)
\\]  
의 형태로 표현됩니다.

가장 기본적인 형태는  
\\[
y = \\frac{a}{x}
\\]  
이며, 이를 **기본 유리함수**라고 합니다.
""")

st.info("※ 유리함수는 분모가 0이 되는 점에서 정의되지 않으며, 그 점을 기준으로 그래프가 두 부분으로 나뉩니다.")

# ----------------------------- #
# 2️⃣ 기본형 y = a/x
# ----------------------------- #
st.header("2️⃣ 기본형 y = a/x의 그래프 탐구")

a = st.slider("a 값 조절", -5.0, 5.0, 1.0, 0.5)
x = np.linspace(-10, 10, 400)
x = x[x != 0]
y = a / x

fig1, ax1 = plt.subplots()
ax1.plot(x, y, label=f"y = {a}/x")
ax1.axvline(0, color="gray", linestyle="--", label="x = 0 (세로점근선)")
ax1.axhline(0, color="gray", linestyle="--", label="y = 0 (가로점근선)")
ax1.legend()
ax1.grid(True)
ax1.set_xlabel("x")
ax1.set_ylabel("y")
st.pyplot(fig1)

st.markdown("""
✅ **그래프 관찰**
- a > 0일 때: 그래프는 **제1, 제3사분면**에 위치합니다.  
- a < 0일 때: 그래프는 **제2, 제4사분면**에 위치합니다.  
- x = 0은 세로 점근선, y = 0은 가로 점근선입니다.  
- 두 점근선에 대해 **대칭적인 쌍곡선 형태**를 가집니다.
""")

# ----------------------------- #
# 3️⃣ 계수 변화: y = a/(k·x)
# ----------------------------- #
st.header("3️⃣ 계수 변화에 따른 그래프의 모양 (y = a/(k·x))")

a2 = st.slider("a (계수)", -5.0, 5.0, 1.0, 0.5, key="a2")
k = st.slider("k (x계수 변화)", 0.5, 5.0, 1.0, 0.5)

x2 = np.linspace(-10, 10, 400)
x2 = x2[x2 != 0]
y2 = a2 / (k * x2)

fig2, ax2 = plt.subplots()
ax2.plot(x2, y2, label=f"y = {a2}/({k}x)")
ax2.axvline(0, color="gray", linestyle="--")
ax2.axhline(0, color="gray", linestyle="--")
ax2.legend()
ax2.grid(True)
st.pyplot(fig2)

st.markdown("""
🔍 **탐구 결과**
- **k**가 커질수록 그래프가 **x축 방향으로 넓어집니다.**  
- 즉, k는 그래프의 **가로 방향 확대·축소 비율**을 조절하는 역할을 합니다.  
""")

# ----------------------------- #
# 4️⃣ 일반형 y = (ax+b)/(cx+d)
# ----------------------------- #
st.header("4️⃣ 일반형 y = (ax + b)/(cx + d)의 그래프")

st.markdown("""
유리함수의 일반형은  
\\[
y = \\frac{ax + b}{cx + d}
\\]  
로 나타낼 수 있으며,  
이때 그래프는 **평행이동된 쌍곡선**의 형태를 가집니다.

- **세로 점근선:** \\( x = -\\frac{d}{c} \\)  
- **가로 점근선:** \\( y = \\frac{a}{c} \\)
""")

a3 = st.slider("a", -5.0, 5.0, 1.0, 0.5)
b3 = st.slider("b", -5.0, 5.0, 0.0, 0.5)
c3 = st.slider("c", -5.0, 5.0, 1.0, 0.5)
d3 = st.slider("d", -5.0, 5.0, 0.0, 0.5)

x3 = np.linspace(-10, 10, 400)
denom = c3 * x3 + d3
x3 = x3[abs(denom) > 0.05]
y3 = (a3 * x3 + b3) / (c3 * x3 + d3)

fig3, ax3 = plt.subplots()
ax3.plot(x3, y3, label=f"y = ({a3}x + {b3})/({c3}x + {d3})")
ax3.axvline(-d3/c3, color="gray", linestyle="--", label=f"x = {-d3/c3:.2f}")
ax3.axhline(a3/c3, color="gray", linestyle="--", label=f"y = {a3/c3:.2f}")
ax3.legend()
ax3.grid(True)
ax3.set_xlabel("x")
ax3.set_ylabel("y")
st.pyplot(fig3)

st.markdown(f"""
✅ **그래프 특징 요약**
- 세로 점근선: \\( x = {-d3/c3:.2f} \\)  
- 가로 점근선: \\( y = {a3/c3:.2f} \\)  
- b, d 값이 변하면 그래프는 **평행이동**합니다.  
- a, c 값이 변하면 그래프의 **기울기와 점근선 위치**가 달라집니다.
""")

# ----------------------------- #
# 5️⃣ 정리 및 퀴즈
# ----------------------------- #
st.header("5️⃣ 정리 및 개념 확인 퀴즈")

st.markdown("""
### 🧩 오늘 배운 내용 정리
| 구분 | 그래프 형태 | 주요 특징 |
|------|--------------|-------------|
| \\( y = \\frac{a}{x} \\) | 기본형 | 원점 중심 쌍곡선, 점근선 x=0, y=0 |
| \\( y = \\frac{a}{k·x} \\) | 확대·축소형 | k에 따라 그래프 폭 변화 |
| \\( y = \\frac{ax+b}{cx+d} \\) | 일반형 | 점근선 이동, 평행이동 포함 |

---

### 🎯 개념 퀴즈
""")

quiz = st.multiselect(
    "다음 중 옳은 설명을 모두 고르세요.",
    [
        "y = a/x의 세로 점근선은 x = 0이다.",
        "y = a/x의 그래프는 제1, 3사분면 또는 제2, 4사분면에 위치한다.",
        "y = (ax+b)/(cx+d)의 세로 점근선은 x = -d/c이다.",
        "y = (ax+b)/(cx+d)의 가로 점근선은 y = a/c이다.",
        "k가 커질수록 y = a/(kx)의 그래프는 더 넓게 퍼진다."
    ]
)

if st.button("정답 확인"):
    correct = {
        "y = a/x의 세로 점근선은 x = 0이다.",
        "y = a/x의 그래프는 제1, 3사분면 또는 제2, 4사분면에 위치한다.",
        "y = (ax+b)/(cx+d)의 세로 점근선은 x = -d/c이다.",
        "y = (ax+b)/(cx+d)의 가로 점근선은 y = a/c이다.",
        "k가 커질수록 y = a/(kx)의 그래프는 더 넓게 퍼진다."
    }
    if set(quiz) == correct:
        st.success("정답입니다! 🎉 유리함수의 그래프 개념을 완벽히 이해했습니다.")
    else:
        st.error("틀린 문항이 있습니다. 그래프의 점근선과 계수의 의미를 다시 확인해보세요.")

# ----------------------------- #
# 6️⃣ 마무리
# ----------------------------- #
st.divider()
st.markdown("""
## 🌟 학습 마무리
오늘 우리는  
1️⃣ 유리함수의 개념을 이해하고,  
2️⃣ 기본형 \\( y = a/x \\)의 그래프를 그려보고,  
3️⃣ 계수 변화에 따른 확대·축소를 탐구하며,  
4️⃣ 일반형 \\( y = (ax+b)/(cx+d) \\)의 점근선과 이동을 파악했습니다.  

> 이차함수와 마찬가지로, **유리함수도 계수 변화와 평행이동의 의미를 시각적으로 이해하는 것**이 핵심입니다.
""")
